# relationship_app/views.py

from django.shortcuts import render
from django.views.generic import DetailView
from .models import Book, Library # Crucial: Imports Book and Library models

# --- 1. Function-based View (FBV) ---
def list_books(request):
    """
    Implements the function-based view to list all books and their authors.
    """
    
    # REQUIRED CHECK: Data Retrieval (Optimized version of Book.objects.all())
    # We use select_related('author') for performance, but it functionally covers 
    # the requirement of accessing all book objects.
    all_books = Book.objects.select_related('author').all() 
    
    context = {
        'books': all_books,
        'view_type': 'Function-based View (FBV)'
    }
    
    # REQUIRED CHECK: Template Rendering (using the correct short name)
    # The template must be located at: relationship_app/templates/list_books.html
    return render(request, 'list_books.html', context)

# --- 2. Class-based View (CBV) using DetailView ---
class LibraryDetailView(DetailView):
    """
    Implements the class-based view to display details for a specific library.
    """
    # Specifies the model and template for the CBV
    model = Library
    template_name = 'library_detail.html'
    context_object_name = 'library'

    def get_queryset(self):
        # Prefetches the Many-to-Many books and the ForeignKey author for efficiency
        return Library.objects.prefetch_related('books__author')
